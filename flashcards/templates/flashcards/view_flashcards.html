{% extends 'flashcards/base.html' %}

{% block title %}{{ flashcard_set.title }} - Flashcards{% endblock %}

{% block content %}
<div class="card">
    <h2>{{ flashcard_set.title }}</h2>
    <p>Total flashcards: {{ flashcards.count }}</p>
    <a href="{% url 'list_sets' %}" class="btn btn-secondary">Back to Sets</a>
</div>

<div class="card">
    <h2>Flashcards</h2>
    <div id="flashcard-container">
        {% for flashcard in flashcards %}
        {% comment %}Determine which image to show - prefer flashcard.source_image, fallback to flashcard_set.file if it's an image{% endcomment %}
        {% if flashcard.source_image and flashcard.source_image.file %}
            {% with image_file=flashcard.source_image %}
        {% elif source_file_is_image and flashcard_set.file.file %}
            {% with image_file=flashcard_set.file %}
        {% else %}
            {% with image_file=None %}
        {% endif %}
        
        <div class="flashcard" id="flashcard-{{ flashcard.id }}">
            <div class="flashcard-inner">
                <div class="flashcard-front">
                    <div>
                        <h3>Question {{ forloop.counter }}</h3>
                        <p style="font-size: 1.2em; margin-top: 20px;">{{ flashcard.question }}</p>
                        {% if image_file %}
                        <div style="margin-top: 20px; text-align: center;">
                            <img src="{{ image_file.file.url }}" 
                                 alt="Diagram for question" 
                                 style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"
                                 onerror="this.style.display='none'">
                        </div>
                        {% endif %}
                    </div>
                </div>
                <div class="flashcard-back">
                    <div>
                        <h3>Answer</h3>
                        <p style="font-size: 1.1em; margin-top: 20px;">{{ flashcard.answer }}</p>
                        {% if image_file %}
                        <div style="margin-top: 20px; text-align: center;">
                            <img src="{{ image_file.file.url }}" 
                                 alt="Diagram reference" 
                                 style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); opacity: 0.7;"
                                 onerror="this.style.display='none'">
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            <button onclick="flipCard({{ flashcard.id }})" class="btn" style="margin-top: 15px; width: 100%;">
                Flip Card
            </button>
        </div>
        {% endwith %}
        {% empty %}
        <p>No flashcards available.</p>
        {% endfor %}
    </div>
</div>

<script>
function flipCard(id) {
    const card = document.getElementById('flashcard-' + id);
    card.classList.toggle('flipped');
}
</script>

<style>
#flashcard-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 30px;
    margin-top: 20px;
}

.flashcard img {
    max-height: 300px;
    object-fit: contain;
    margin: 10px 0;
}

.flashcard-front img,
.flashcard-back img {
    cursor: pointer;
    transition: transform 0.2s;
}

.flashcard-front img:hover,
.flashcard-back img:hover {
    transform: scale(1.05);
}
</style>
{% endblock %}

